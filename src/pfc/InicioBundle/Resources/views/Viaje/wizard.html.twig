{% extends '::frontend.html.twig' %}

{% block title 'Wizard Viaje' %} 

{% block stylesheets %}
    {{ parent() }}

<style>
form label{ width:500px;    font-weight:normal;}        
form ul{    list-style:none;}         
</style>
{#
<link href="{{ asset('bundles/inicio/css/checkbox.css') }}" type="text/css" rel="stylesheet" />
#}

{% endblock %}   

{% block article -%}
    <h1>Wizard viaje</h1>

    {% if op is defined %}
<br />OP:_____{{op}}   
<hr />

    {% if op == 0 %}

        <form action="{{ path('viaje_wizard') }}" method="post">
          <p>Nombre de la ciudad a buscar:</p>
          <p>
             <input type="text"   name="ciudad" value="{{ ciudad }}" style="width:600px;height:1.5em;font-size:2em;" />
             <input type="hidden" name="op"     value="0" />
             <input type="submit"               value="Buscar" style="height:3em;width:5em;"/>
          </p>
        </form>  




        {% if ciudad %}        
        <form action="{{ path('viaje_opciones') }}" method="post">
        {% set cont  = 1 %}   
        {% set sel   = 0 %}
        {% if places|length > 0 %}  
            <h2>Elegir una ciudad de las siguientes propuestas (desambiguación):   </h2>
            <p id="miMapa" style="margin-top:1em;width:680px;height:500px;border:1px cyan solid;" ></p>
            <ol>
            {% for p0 in places %}  
            {% for p1 in p0 %}
                {% if p1.res|length > 0 %}
                    <p><b>{{p1.txt}}</b></p>
                    {% for p2 in p1.res %}
                        {% set lat  = p2.lat|number_format(2, '.') %}
                        {% set lon  = p2.lon|number_format(2, '.') %}
                        {% set name = p2.name %}
                        {% set prm = '?op=1&lat='~lat~'&lon='~lon~'&ciudad='~ciudad~'&q='~name %}
                        <li value="{{cont}}" id="s{{sel}}-{{cont}}">
                            <input type="radio"  name="s{{sel}}"                  value="{{cont}}" />
                            <input type="hidden" name="s{{sel}}-{{cont}}_lat"     value="{{lat}}" />
                            <input type="hidden" name="s{{sel}}-{{cont}}_lon"     value="{{lon}}" />
                            <a href="{{prm}}" style="text-decoration:none;">
                                <span title="Latitud" style="text-align:right;background-color:lightcyan;width:4em;display:inline-block;">
                                {{ lat }}
                                </span>
                            </a>                                    
                            <a href="{{prm}}" style="text-decoration:none;">
                                <span title="Longitud" style="text-align:right;background-color:lightcyan;width:4em;display:inline-block;">
                                {{ lon }}
                                </span>
                            </a>                                    

                            <a href="{{prm}}" style="text-decoration:none;">
                            <span title="Nombre" style="width:auto;display:inline-block;">{{ name }}</span>
                            </a>
                        </li>
                        {% set cont = cont + 1 %}
                    {% endfor %}  
                {% endif %}    
            {% endfor %}
            {% endfor %}
        {% else %}          
        <p style="color:red;">Ningún resultado.</p>
        <ol>
        {% endif %}
                
        <p>Indicar coordenadas geográficas:</p>
        <li value="{{cont}}" id="s{{sel}}-{{cont}}">
            <input type="radio"  name="s{{sel}}"                  value="{{cont}}"   />
            <input type="text"   name="s{{sel}}-{{cont}}_lat"     value="10"  style="width:4em;" title="Latitud"/>
            <input type="text"   name="s{{sel}}-{{cont}}_lon"     value="-20" style="width:4em;" title="Longitud"/>
            latitud y longitud en formato decimal.
        </li>
        </ol>

        {% if servicios is defined %}
        {% if servicios %}
            <h2>Consultar información de:</h2>
            <div class="wrapper-demo">
            <ul id="demo2">
                {% for s in servicios %}
                    {% set checked = 'checked="checked"' %}
                    {% set i       = loop.index %}
                    <li>
                        <input type="checkbox" name="s{{s['id']}}" id="Check{{i}}" value="{{s['id']}}" {% if false %}{{checked}}{% endif %} />
                        <label for="Check{{i}}">{{s['id']}} - {{s['nom']}}</label>
                    </li>
                {% endfor %}                
            </ul>
            </div>            
        {% else %}
            <p style="color:red;">Ningún servicio disponible.</p>
        {% endif %}
        {% endif %}
        <input type="hidden" name="ciudad"     value="{{ciudad}}" />
        <input type="submit"               value="Guardar opciones" style="height:3em;width:20em;"/>
        </form>

        {% endif %}  
        
        

        


<hr /><pre style="font-size:0.75em;border:1px red dashed;">X:{{dump(x)}}</pre>        
{#<hr /><pre style="font-size:0.75em;border:1px red dashed;">{{dump(servicios)}}</pre>  #}      
        
        
    {% elseif op == 1 %}{# -----------------------------------------------  #}

        <h1>{{data['d00']['res']['q']}}</h1>     
   
        <div style="border:0px blue solid;">
        {% if data['d01'] is defined  %}{% if data['d01'] is not null  %}      
        <h2>{{data['d01']['txt']}}</h2>
        <span style="float:left;display:block;margin-right:3em;width:10em;">{{ data['d01']['res']['datetime']|date('d - m - Y') }}</span>
        <span style="float:left;display:block;margin-right:3em;width:10em;">{{ data['d01']['res']['datetime']|date('H : i : s') }}</span>
        <span style="float:left;display:block;margin-right:3em;width:10em;">offset: {{ data['d01']['res']['offset'] }}</span>
        <p style="clear:left;color:lightgrey;font-size:8px;text-align:right;">Fuente:World Weather Online</p>
        {% endif %}{% endif %}
        </div>
  
        <div style="border:0px blue solid;">
        {% if data['d02'] is defined  %}{% if data['d02'] is not null  %}      
        <h2>{{data['d02']['txt']}}</h2>
        <img src="{{ data['d02']['res'] }}" width="600" height="400" alt="OpenStreetMap" />
        Coordenadas:
        <a href="https://maps.google.de/maps?q={{data['d00']['res']['lat']}},{{data['d00']['res']['lon']}}" target="_blank" title="ver en Google Maps" style="text-decoration:none;color:grey;">
            {{data['d00']['res']['lat']}},{{data['d00']['res']['lon']}}
        </a>
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:OpenStreetMap</p>                
        {% endif %}{% endif %}
        </div>

        <div style="border:0px blue solid;">
        {% if data['d03'] is defined  %}{% if data['d03'] is not null  %}
        <h2>{{data['d03']['txt']}}</h2>
        {% for p in data['d03']['res'] %}    
            {% if loop.index0 is even %}    {% set color = 'lightblue' %}
            {% else %}                      {% set color = 'lightpink' %}
            {% endif %}
            &gt;
            <span style="background-color:{{color}};width:auto;display:inline-block;">{{p}}</span>
        {% endfor %}
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:GeoNames</p>   
        {% endif %}{% endif %} 
        </div>

        <div style="border:0px blue solid;">
        {% if data['d04'] is defined  %}{% if data['d04'] is not null  %}
        <h2>{{data['d04']['txt']}}</h2>
        <p>
        <table style="text-align:center;">  
        <tr>
            <th>Reciente</th>
            <th colspan="4">Previsión</th>
        </tr>
        {% for f in 1..6 %}
        <tr>
            {% for c in -1..data['d04']['res']['forecast']|length -1  %}
            <td>
            {% if loop.first %} 
                <b>
                {% if     f==1 %} <span title="Fecha">{{data['d04']['res']['current']['observation_time']}}   </span>
                {% elseif f==2 %} <span title="Imagen"><img src="{{data['d04']['res']['current']['weatherIconUrl']}}" />   </span>
                {% elseif f==3 %} <span title="Descripción">{{data['d04']['res']['current']['weatherDesc']}}</span>
                {% elseif f==4 %} <span title="Temperatura">{{data['d04']['res']['current']['temp_C']}} &ordm;C</span>
                {% elseif f==5 %} <span title="Precipitación">{{data['d04']['res']['current']['precipMM']}} mm</span>
                {% elseif f==6 %} <span title="Viento (velocidad, dirección)">
                                    {{data['d04']['res']['current']['windspeedKmph']}} km/h,&nbsp;
                                    {{data['d04']['res']['current']['winddirDegree']}} &ordm;
                                    {{data['d04']['res']['current']['winddir16Point']}}
                                  </span>
                {% endif %} 
                </b>
            {% else %}  
                {% set ff = loop.index0 - 1 %}
                {% if     f==1 %} <span title="Fecha">{{data['d04']['res']['forecast'][ff]['date']|date('d-m-Y')}}      </span>
                {% elseif f==2 %} <span title="Imagen"><img src="{{data['d04']['res']['forecast'][ff]['weatherIconUrl']}}" />   </span>
                {% elseif f==3 %} <span title="Descripción">{{data['d04']['res']['forecast'][ff]['weatherDesc']}}</span>
                {% elseif f==4 %} <span title="Temperatura">
                                    <span style="color:blue;">{{data['d04']['res']['forecast'][ff]['tempMinC']}}</span> &ordm;C &nbsp; 
                                    <span style="color:red;">{{data['d04']['res']['forecast'][ff]['tempMaxC']}}</span> &ordm;C
                                  </span>
                {% elseif f==5 %} <span title="Precipitación">{{data['d04']['res']['forecast'][ff]['precipMM']}} mm</span>
                {% elseif f==6 %} <span title="Viento (velocidad, dirección)">
                                    {{data['d04']['res']['forecast'][ff]['windspeedKmph']}} km/h,&nbsp;
                                    {{data['d04']['res']['forecast'][ff]['winddirDegree']}} &ordm;
                                    {{data['d04']['res']['forecast'][ff]['winddir16Point']}}
                                  </span>
                {% endif %}        
            {% endif %}        
            </td>
            {% endfor %}        
        </tr>
        {% endfor %}
        </table>
        </p>    
        <p style="font-size:0.8em;text-align:left;color:grey;">* Reciente:
            <span title="Humedad"       style="margin-right:1em;">Humedad:    {{data['d04']['res']['current']['humidity']}}  </span>
            <span title="Visibilidad"   style="margin-right:1em;">Visibilidad:{{data['d04']['res']['current']['visibility']}}</span>
            <span title="Nubes"         style="margin-right:1em;">Nubes:      {{data['d04']['res']['current']['cloudcover']}}</span>
        </p>
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:World Weather Online</p>        
        {% endif %}{% endif %}
        </div>

        <div style="border:0px blue solid;float:left;">
        {% if data['d05'] is defined  %}{% if data['d05'] is not null  %}
        <h2>{{data['d05']['txt']}}</h2>
        {% for pk,pv in data['d05']['res'] %}  
        <div style="border:0px red solid;width:21.5em;float:left;">
            <label>Con más de {{pk}} habitantes:</label>
            <ul style="list-style:none;">
                {% for lug in pv %}  
                <li>{{lug['dis']|number_format(0, '.')}} km - {{lug['lug']}}</li>
                {% endfor %}                     
            </ul>
        </div>
        {% endfor %}  
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:GeoNames</p>        
        {% endif %}{% endif %}
        </div>
        
        <div style="clear:both;"></div>
        
        <div style="border:0px blue solid;float:left;">
        {% if data['d06'] is defined  %}{% if data['d06'] is not null  %}
        <h2>{{data['d06']['txt']}}</h2>
        <div style="float:left;">
            {% for pk,pv in data['d06']['res']['rates'] %}  
              {#<p style="float:left;margin:30px -30px 20px 1px;border:1px transparent solid;-webkit-transform: rotate(-25deg);"><b>{{pk}}</b> {{pv}}</p>#} 
                <p style="width:5em;float:left;margin:0px -4px 3px 8px;border:1px lightgrey dashed;-webkit-transform: rotate(0deg);"><b>{{pk}}</b> &nbsp;{{pv}}</p>
            {% endfor %}           
        </div>
        <div style="float:left;margin-top:1em;font-size:0.8em;text-align:left;color:grey;">
            Cambios oficiales de divisas a Euros el {{data['d06']['res']['date']|date('d-m-Y')}}. (1 EUR; = )
        </div>
        <p style="clear:both;color:lightgrey;font-size:8px;text-align:right;">Fuente:BCE.</p>        
        {% endif %}{% endif %}
        </div>        
                
        <div style="clear:both;"></div>
        
        <div style="border:0px blue solid;">
        {% if data['d07'] is defined  %}{% if data['d07'] is not null  %}
        <h2>{{data['d07']['txt']}}</h2>
        <dl>
        {% for p in data['d07']['res'] %}
            <dt><a href="{{p['wikipediaUrl']}}" target="_blank" style="text-decoration:none;">{{p['title']}}</a></dt>
            <dd>
                {% if p['thumbnailImg'] is not empty %}
                <span><img src="{{p['thumbnailImg']}}"  style="float:left;"/></span>  
                {% endif %}    
                <span>{{p['summary']}}</span>  
            </dd>
        {% endfor %}   
        </dl>
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:GeoNames</p>
        {% endif %}{% endif %} 
        </div>        

        <div style="border:0px blue solid;">
        {% if data['d08'] is defined  %}{% if data['d08'] is not null  %}
        <h2>{{data['d08']['txt']}}</h2>
        <ul style="list-style:none;">
        {% for p in data['d08']['res'] %}
            <li><a href="{{p['fullurl']}}" target="_blank" style="text-decoration:none;">{{p['title']}}</a></li>
        {% endfor %}   
        </ul>
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:Wikipedia</p>
        {% endif %}{% endif %} 
        </div>             
        
        <div style="border:0px blue solid;">
        {% if data['d09'] is defined  %}{% if data['d09'] is not null  %}
        <h2>{{data['d09']['txt']}}</h2>
        <ul style="list-style:none;">
        {% for p in data['d09']['res'] %}
            <li><a href="{{p['fullurl']}}" target="_blank" style="text-decoration:none;">{{p['title']}}</a></li>
        {% endfor %}   
        </ul>
        <p style="color:lightgrey;font-size:8px;text-align:right;">Fuente:Wikitravel</p>
        {% endif %}{% endif %} 
        </div>   
        
        
        
    
        
        
        
        
        
<section class="ac-container">        
 <div>
    <input id="ac-1" name="accordion-1" type="checkbox" />
    <label for="ac-1">Contact us</label>
    <article class="ac-large">
       <p>xxxxxxxxxxxxxxxxxxxxxxxxxxxxx </p>
    </article>
 </div>
</section>
        
        
        
     
  {#         
        <div style="border:0px blue solid;">
        {% if data['d10'] is defined  %}{% if data['d10'] is not null  %}      
        <h2>{{data['d10']['txt']}}</h2>
        <span style="float:left;display:block;margin-right:3em;width:10em;">{{ data['d10']['res']['datetime']|date('d - m - Y') }}</span>
        <span style="float:left;display:block;margin-right:3em;width:10em;">{{ data['d10']['res']['datetime']|date('H : i : s') }}</span>
        <span style="float:left;display:block;margin-right:3em;width:10em;">offset: {{ data['d10']['res']['offset'] }}</span>
        <p style="clear:left;color:lightgrey;font-size:8px;text-align:right;">Fuente:World Weather Online</p>
        {% endif %}{% endif %}
        </div>        
        
        
        
        
        
            

<hr /><pre style="font-size:0.75em;border:1px red dashed;">{{dump(data)}}</pre> 
        {% if data|length > 2 %}
        Data mes gran de 2.
        {% else %}          
        Ningún resultado.
        {% endif %}        
  #}   
        
        
        
      

           

    {% endif %}
            
    {% endif %}    

<hr /><pre style="font-size:0.75em;border:1px red dashed;">{{dump(places)}}</pre>       

    
    
    
    
    
    
{# 


#}    
    
   

{% endblock %}
            
{% block aside %}
    <ul class="record_actions">
        <li><a href="{{ path('viaje') }}"        >mis viajes</a></li>
        <li><a href="{{ path('viaje_wizard') }}" >RECARGAR</a></li>
    </ul>   
{% endblock %} 
            
{% block javascripts %}
    {{ parent() }}
            
    {#        
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="simple-expand.js"></script>
    
    <script type="text/javascript">
        $(function () {
            $('.expander').simpleexpand();
            prettyPrint();
        });
    </script>       
    #}
        
    {% if op is defined %}
    {% if op == 0 %}            
    <script type="text/javascript"  src="http://www.openlayers.org/api/OpenLayers.js"></script>  
    <script type="text/javascript">                                                            
    //http://harrywood.co.uk/maps/examples/openlayers/simple-marker.html
    //http://www.openlayers.org/dev/examples/markers.html
    //http://wiki.openstreetmap.org/wiki/OpenLayers_Marker_Example

     var mapa        = new OpenLayers.Map("miMapa");   

     mapa.addControl(new OpenLayers.Control.LayerSwitcher(true));                             
     mapa.addControl(new OpenLayers.Control.ScaleLine());       
    //mapa.addControl(new OpenLayers.Control.Permalink());
    //mapa.addControl(new OpenLayers.Control.Permalink('permalink'));
    //mapa.addControl(new OpenLayers.Control.MousePosition({ numDigits: 2 }));                 
    //mapa.addControl(new OpenLayers.Control.PanZoomBar());     

     var markers = new OpenLayers.Layer.Markers( "Markers" );

     var layerBase   = new OpenLayers.Layer.OSM("Simple OSM Map");
     mapa.addLayer(layerBase);  

     var lat        = 0;
     var lon        = 0;
     var zoom       = 0;
     
     var lonLat1      = new OpenLayers.LonLat(lon,lat).transform(new OpenLayers.Projection("EPSG:4326"),mapa.getProjectionObject());
     var marcador1    = new OpenLayers.Marker(lonLat1);
     
     var size     = new OpenLayers.Size(20,20);
   //var offset   = new OpenLayers.Pixel(-(size.w/2), -size.h);     
   //var icon     = new OpenLayers.Icon('http://www.openlayers.org/dev/img/marker.png',size,offset);

    {% set i  = 0 %}             
    {% if places|length > 0 %}
        {% for p0 in places %}
        {% for p1 in p0 %}
            {% if p1.res|length > 0 %}
                {% for p2 in p1.res %}
                    {% set i = i + 1 %}
                    {% set lat  = p2.lat %}
                    {% set lon  = p2.lon %}
                    {% set name = p2.name %}
                    {% set prm = '?op=1&lat='~lat~'&lon='~lon~'&ciutat='~ciudad~'&q='~name %}
                    var lonLat{{i}}   = new OpenLayers.LonLat({{lon}},{{lat}}).transform(new OpenLayers.Projection("EPSG:4326"),mapa.getProjectionObject());
                    var marcador{{i}} = new OpenLayers.Marker(lonLat{{i}});
                    markers.addMarker(marcador{{i}});
                {% endfor %}  
            {% endif %}    
        {% endfor %}
        {% endfor %}
    {% endif %}      

    {% set i  = 0 %}    
    {% if places|length > 0 %}
        {% for p0 in places %}
        {% for p1 in p0 %}
            {% if p1.res|length > 0 %}
                {% for p2 in p1.res %}
                    {% set i  = i + 1 %}  
                    {% set lat  = p2.lat %}
                    {% set lon  = p2.lon %}
                    {% set name = p2.name %}
                    marcador{{i}}.events.register("click", marcador{{i}}, function(e){
                    text='<a href="#s0-{{i}}" width="20" height="2">{{name}}</a>';
                    popup = new OpenLayers.Popup.FramedCloud("chicken",lonLat{{i}},size,text,null, true);
                    mapa.addPopup(popup);});
                {% endfor %}  
            {% endif %}    
        {% endfor %}
        {% endfor %}
    {% endif %}     

     mapa.setCenter (lonLat1, zoom);

     mapa.addLayer(markers);

    </script>    
    {% endif %}   
    {% endif %}
    
    
{#    
    <script src="{{ asset('bundles/inicio/js/checkbox/jquery-1.9.1.min.js')    }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/inicio/js/checkbox/jquery-checkbox-2.0.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
                $('#demo1 input').checkbox();

                $('#demo2 input').checkbox({
                        className:      'jquery-switch',
                        checkedClass:   'jquery-switch-on'
                });

                $('#demo3 input').checkbox({
                        className:      'jquery-tick',
                        checkedClass:   'jquery-tick-on'
                });
        });
    </script>    
#}
    
{% endblock %}            